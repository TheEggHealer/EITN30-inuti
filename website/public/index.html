<html>
	<head>
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
		<title>SnakeData</title>
	</head>
	<body>
    <div class="panel">
      <img src="assets/logo-dark-mode.svg" style="margin-bottom: 40px;" alt="">
      <h1 class="header">Welcome to <span class="color-primary">Snake</span><span class="color-secondary">Data</span></h1>
      <h3>Get your data where your snake is <span class="color-primary hover"><a href="https://instagram.com/snakesinthelake" target="_blank">@</a></span></h3>
      <!-- ondragover="stopDefault(event);dragOver(this, 'Drop the images to upload them.');"
        ondragenter="stopDefault(event);dragOver(this, 'Drop the images to upload them.');"
        ondragleave="stopDefault(event);dragLeave(this);"
        ondrop="stopDefault(event);dragLeave(this);addFilesAndSubmit(event);" -->
      <div 
        id="drop-zone" 
        ondragover="stopDefault(event);hoverFile(event);"
        ondragleave="stopDefault(event);unHoverFile(event);"
        ondragenter="stopDefault(event);hoverFile(event);"
        ondrop="stopDefault(event);unHoverFile(event);handleFile(event);">
        <!-- <img style="margin-bottom: 10px" src="../assets/arrow.svg" alt=""> -->

        <svg class="arrow-box" style="margin-bottom: 10px" width="74" height="54" viewBox="0 0 74 54" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g id="group" clip-path="url(#clip0_305_661)">
            <path id="box" fill-rule="evenodd" clip-rule="evenodd" d="M2 32C3.10457 32 4 32.8954 4 34V46C4 48.2091 5.79086 50 8 50H66C68.2091 50 70 48.2091 70 46V34C70 32.8954 70.8954 32 72 32C73.1046 32 74 32.8954 74 34V46C74 50.4183 70.4183 54 66 54H8C3.58172 54 0 50.4183 0 46V34C0 32.8954 0.89543 32 2 32Z" fill="url(#paint0_linear_305_661)"/>
            <path id="arrow" fill-rule="evenodd" clip-rule="evenodd" d="M51.1422 25.6863L38.4143 38.4142C37.6333 39.1953 36.3669 39.1953 35.5859 38.4142L22.858 25.6863C22.0769 24.9052 22.0769 23.6389 22.858 22.8579C23.639 22.0768 24.9054 22.0768 25.6864 22.8579L35.0001 32.1716L35.0001 2C35.0001 0.895431 35.8955 6.9206e-07 37.0001 6.43778e-07C38.1047 5.95496e-07 39.0001 0.895431 39.0001 2L39.0001 32.1716L48.3138 22.8579C49.0949 22.0768 50.3612 22.0768 51.1422 22.8579C51.9233 23.6389 51.9233 24.9052 51.1422 25.6863Z" fill="url(#paint1_linear_305_661)"/>
          </g>
          <defs>
            <linearGradient id="paint0_linear_305_661" x1="37" y1="-3.80386e-06" x2="37" y2="54" gradientUnits="userSpaceOnUse">
              <stop stop-color="#FFA800"/>
              <stop offset="1" stop-color="#E26D00"/>
            </linearGradient>
            <linearGradient id="paint1_linear_305_661" x1="37" y1="0" x2="37" y2="54" gradientUnits="userSpaceOnUse">
              <stop stop-color="#FFA800"/>
              <stop offset="1" stop-color="#E26D00"/>
            </linearGradient>
            <clipPath id="clip0_305_661">
              <rect width="74" height="54" fill="white"/>
            </clipPath>
          </defs>
        </svg>

        <div id="upload-bar">
          <p>Upload file</p>
          <div class="progress-container">
            <div id="progress-bar"></div>
          </div>
        </div>

        <script>
          function stopDefault(event) {
            event.stopPropagation();
            event.preventDefault();
          }

          function handleFile(event) {
            document.getElementById('drop-zone').classList.add('dropped-file')
            document.getElementById('upload-bar').classList.add('dropped-file')
            var file = event.target.files || event.dataTransfer.files;
            
            console.log(file)
            
            var fd = new FormData();
            fd.append('file', file[0], file[0].name);
            var x = new XMLHttpRequest();
            
            
            let bytes = file[0].size;
            let time = bytes/(1500 * 6.5);
            let interval = (time/100) * 1000;
            console.log(interval)
            let percent = 0;
            let progress = window.setInterval(function () {
              console.log(percent)
              if (percent <= 100) {
                document.getElementById('progress-bar').style.width = percent + '%';
              }
              percent++;
            },interval)
            

            
            x.onreadystatechange = function () {
              if(x.readyState == 4) {
                
                document.getElementById('drop-zone').classList.remove('dropped-file')
                document.getElementById('upload-bar').classList.remove('dropped-file')
                if(x.status == 200) {
                  // success
                  window.clearInterval(progress)
                  document.getElementById('progress-bar').style.width = '100%';
                }
                else {
                  // failed - TODO: Add code to handle server errors
                }
              }
            };

            x.open("post", '/upload', true);
            x.send(fd);
            
            console.log('File uploaded')
          }

          function hoverFile(event) {
            event.preventDefault() 
            document.getElementById('drop-zone').classList.add('hover-file')
          }
          
          function unHoverFile(event) {
            event.preventDefault() 
            document.getElementById('drop-zone').classList.remove('hover-file')
          }
        </script>

      </div>
    </div>
	</body>
</html>